{% extends 'base.html' %}

{% block title %}Daftar Pendaftar - COCONUT Computer Club{% endblock %}

{% block content %}
<main id="main">

  <section id="pendaftar-hero" class="d-flex align-items-center position-relative overflow-hidden py-5">
    <div class="background-animation"></div>
    <div class="container position-relative z-index-1" data-aos="fade-up">
      <div class="row justify-content-center text-center">
        <div class="col-lg-8">
          <h1 class="display-4 fw-bold mb-3">Daftar Calon Anggota</h1>
          <p class="lead -50">Jelajahi profil pendaftar baru yang bersemangat untuk bergabung dengan COCONUT Computer Club.</p>
        </div>
      </div>
    </div>
  </section><section id="pendaftar-list" class="py-5">
    <div class="container" data-aos="fade-up" data-aos-delay="100">
      <div class="row gx-5 justify-content-center">
        <div class="col-lg-11 col-xl-9 col-xxl-8">
          <div class="d-flex align-items-center justify-content-between mb-4">
            <h2 class="text-primary fw-bolder mb-0">Daftar Pendaftar</h2>
            <a class="btn btn-primary px-4 py-2 rounded-pill shadow" href="#" id="download-button">
              <div class="d-inline-block bi bi-file-earmark-arrow-down me-2"></div>
              Unduh Data
            </a>
          </div>

          <div id="data-container" class="row g-4">
            </div>
          
          <div id="loading-spinner" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Memuat...</span>
            </div>
          </div>
          <div id="no-data-message" class="text-center mt-5 d-none">
            <p class="lead text-muted">Belum ada data pendaftar.</p>
          </div>
        </div>
      </div>
    </div>
  </section></main>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", async function() {
        const dataContainer = document.getElementById('data-container');
        const loadingSpinner = document.getElementById('loading-spinner');
        const noDataMessage = document.getElementById('no-data-message');
        
        async function fetchData() {
            try {
                const response = await fetch('{{ url_for("getData")}}');
                if (!response.ok) {
                    throw new Error('Gagal memuat data pendaftar.');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function displayData(data) {
            loadingSpinner.classList.add('d-none');
            if (!data || data.length === 0) {
                noDataMessage.classList.remove('d-none');
                return;
            }

            data.forEach(item => {
                const cardCol = document.createElement('div');
                cardCol.className = 'col-lg-6';

                const card = document.createElement('div');
                card.className = 'card shadow-sm border-0 rounded-4 h-100';

                const cardBody = document.createElement('div');
                cardBody.className = 'card-body p-4';

                cardBody.innerHTML = `
                    <div class="d-flex align-items-center mb-3">
                        <div class="me-3">
                            <img src="{{ url_for('static', filename='') }}${item.foto}" alt="${item.nama_lengkap}" class="rounded-circle" style="width: 70px; height: 70px; object-fit: cover;">
                        </div>
                        <div>
                            <h5 class="fw-bold mb-0 text-primary">${item.nama_lengkap}</h5>
                            <p class="text-muted small mb-0">${item.jurusan}, ${item.kampus}</p>
                            <span class="badge bg-light text-secondary mt-1">${item.tanggal}</span>
                        </div>
                    </div>
                    <hr class="my-3">
                    <p class="card-text fw-semibold mb-2">Alasan Masuk:</p>
                    <p class="text-muted small mb-0">${item.alasan}</p>
                `;

                card.appendChild(cardBody);
                cardCol.appendChild(card);
                dataContainer.appendChild(cardCol);
            });
        }
        
        const data = await fetchData();
        displayData(data);
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/scripts.js')}}"></script>
{% endblock %}