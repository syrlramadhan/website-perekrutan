{% extends 'base.html' %}

{% block content %}
  <style>
    /* Importing Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;600;700&display=swap');

    :root {
      --primary: #1e3a8a;
      --accent: #3b82f6;
      --accent-2: #2563eb;
      --muted: #6b7280;
      --card-bg: rgba(255, 255, 255, 0.98);
      --shadow: 0 8px 32px rgba(16, 24, 40, 0.12);
      --border-radius: 12px;
    }

    body {
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      line-height: 1.6;
      color: #111827;
      background: #f9fafb;
      overflow-x: hidden;
      margin: 0;
    }

    h1, h2, h3 {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      color: var(--primary);
    }

    h1 { font-size: 3rem; letter-spacing: -0.025em; }
    h2 { font-size: 2rem; }
    p, .lead { font-size: 1.1rem; line-height: 1.8; }
    .text-muted { color: var(--muted); }

    /* Enhanced Animated Background */
    .background-animation {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      opacity: 0.15;
      z-index: -1;
    }
    .background-animation::before,
    .background-animation::after {
      content: '';
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      filter: blur(50px);
      animation: pulse 8s ease-in-out infinite;
    }
    .background-animation::before {
      top: -15%;
      right: -15%;
      background: linear-gradient(135deg, var(--accent), rgba(37, 99, 235, 0.2));
    }
    .background-animation::after {
      bottom: -15%;
      left: -15%;
      background: linear-gradient(135deg, var(--accent-2), rgba(96, 165, 250, 0.3));
      animation-delay: 2s;
    }
    .background-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      animation: float 5s ease-in-out infinite;
      opacity: 0.5;
    }
    .particle-1 { top: 15%; left: 25%; animation-delay: 0s; }
    .particle-2 { top: 35%; right: 20%; animation-delay: 1.2s; }
    .particle-3 { bottom: 25%; left: 30%; animation-delay: 2.4s; }
    .particle-4 { top: 60%; left: 10%; animation-delay: 3.6s; }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50% { transform: scale(1.3); opacity: 0.6; }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-25px) rotate(10deg); }
    }

    /* Hero Section */
    #daftar-hero {
      background: linear-gradient(120deg, var(--primary) 0%, var(--accent-2) 50%, var(--accent) 100%);
      color: white;
      position: relative;
      overflow: hidden;
      padding: 4rem 0;
      text-align: center;
      margin-top: -40px; /* Sedikit jarak dari header */
    }
    #daftar-hero h1 {
      font-weight: 800;
      font-size: 3.5rem;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      margin-bottom: 1rem;
      color: white;
    }
    #daftar-hero .lead {
      font-family: 'Inter', sans-serif;
      font-size: 1.25rem;
      max-width: 700px;
      margin: 0 auto;
      opacity: 0.9;
      color: white;
    }

    /* Form Section */
    #daftar-form {
      background: linear-gradient(180deg, #f9fafb, rgba(147, 197, 253, 0.15));
      padding: 1rem 0; /* Reduced padding to minimize vertical space */
      margin-bottom: 0; /* Ensure no extra margin */
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      border: none;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      padding: 1.5rem; /* Reduced padding for a compact look */
      margin-bottom: 0; /* Explicitly remove bottom margin */
    }
    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(16, 24, 40, 0.2);
    }

    /* Form Elements */
    .form-control,
    .form-select {
      border-radius: var(--border-radius);
      padding: 0.75rem 1rem;
      border: 1px solid rgba(37, 99, 235, 0.25);
      background: rgba(255, 255, 255, 0.99);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .form-control:focus,
    .form-select:focus {
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      outline: none;
    }

    /* Radio Buttons */
    .form-check-input {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid rgba(37, 99, 235, 0.4);
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .form-check-input:checked {
      background-color: var(--accent);
      border-color: var(--accent);
    }
    .form-check-label {
      margin-left: 1.5rem;
      font-weight: 500;
      cursor: pointer;
      color: #374151;
    }
    .form-check:hover .form-check-label { color: var(--accent); }

    /* File Input */
    input[type='file'].form-control {
      border: 2px dashed rgba(37, 99, 235, 0.4);
      background: rgba(255, 255, 255, 0.99);
      border-radius: var(--border-radius);
      padding: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type='file'].form-control:hover,
    input[type='file'].form-control:focus {
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }

    /* Textarea */
    textarea.form-control {
      min-height: 160px;
      border-radius: var(--border-radius);
      resize: vertical;
    }

    /* Submit Button */
    #submitButton {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border: none;
      color: white;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 1.1rem;
      padding: 0.9rem 3rem;
      border-radius: 2rem;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }
    #submitButton:hover {
      background: var(--primary);
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    }
    #submitButton:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Feedback Messages */
    #submitSuccessMessage, #submitErrorMessage {
      padding: 1rem;
      border-radius: var(--border-radius);
      text-align: center;
      margin-top: 1rem;
      margin-bottom: 0;
    }
    #submitSuccessMessage {
      background: rgba(147, 197, 253, 0.3);
      border: 1px solid var(--accent);
    }
    #submitErrorMessage {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid #ef4444;
    }

    /* Form */
    #daftarForm {
      margin-bottom: 0; /* Ensure form has no bottom margin */
    }

    /* Toast Styling */
    .toast {
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      min-width: 300px;
    }
    .toast.bg-success { background: var(--accent) !important; }
    .toast.bg-danger { background: #ef4444 !important; }

    /* Responsive Adjustments */
    @media (max-width: 991px) {
      #daftar-hero { padding: 3rem 0; }
      #daftar-hero h1 { font-size: 2.5rem; }
      .card { padding: 1rem; }
    }
    @media (max-width: 767px) {
      #daftar-hero { padding: 2rem 0; }
      #daftar-hero h1 { font-size: 2rem; }
      #daftar-hero .lead { font-size: 1rem; }
      .card { padding: 0.75rem; }
      #submitButton { padding: 0.8rem 2.5rem; font-size: 1rem; }
    }
  </style>

  <!-- Hero Section -->
  <section id="daftar-hero" class="d-flex align-items-center position-relative">
    <div class="background-animation">
      <div class="background-particle particle-1"></div>
      <div class="background-particle particle-2"></div>
      <div class="background-particle particle-3"></div>
      <div class="background-particle particle-4"></div>
    </div>
    <div class="container" data-aos="fade-up">
      <div class="row justify-content-center text-center">
        <div class="col-lg-10">
          <h1 class="mb-3" style="color: white;">Pendaftaran Anggota COCONUT Computer Club</h1>
          <p class="lead">Bergabunglah dengan kami dengan mengisi formulir di bawah ini.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;"></div>

  <!-- Form Section -->
  <section id="daftar-form">
    <div class="container" data-aos="fade-up" data-aos-delay="100">
      <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
          <div class="card">
            <div class="text-center mb-4">
              <h2>Formulir Pendaftaran</h2>
              <p class="text-muted">Isi informasi dengan benar untuk bergabung dengan komunitas kami.</p>
            </div>
            <form id="daftarForm" class="row g-4">
              <div class="col-md-6">
                <input class="form-control" id="nama_lengkap" name="nama_lengkap" type="text" placeholder="Nama Lengkap" required />
                <div class="invalid-feedback">Nama Lengkap diperlukan.</div>
              </div>
              <div class="col-md-6">
                <input class="form-control" id="nama_panggilan" name="nama_panggilan" type="text" placeholder="Nama Panggilan" required />
                <div class="invalid-feedback">Nama Panggilan diperlukan.</div>
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold mb-2">Jenis Kelamin</label>
                <div class="d-flex gap-4 flex-wrap">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="jenis_kelamin" id="pria" value="Pria" required />
                    <label class="form-check-label" for="pria">Pria</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="jenis_kelamin" id="wanita" value="Wanita" required />
                    <label class="form-check-label" for="wanita">Wanita</label>
                  </div>
                </div>
                <div class="invalid-feedback d-block">Pilih jenis kelamin.</div>
              </div>
              <div class="col-md-6">
                <input class="form-control" id="email" name="email" type="email" placeholder="Email" required />
                <div class="invalid-feedback">Email valid diperlukan.</div>
              </div>
              <div class="col-md-6">
                <input class="form-control" id="nomor_wa" name="nomor_wa" type="tel" placeholder="Nomor WhatsApp" required pattern="[0-9]+" />
                <div class="invalid-feedback">Nomor WhatsApp diperlukan (hanya angka).</div>
              </div>
              <div class="col-12">
                <input class="form-control" id="username_telegram" name="username_telegram" type="text" placeholder="Username Telegram" required />
                <div class="invalid-feedback">Username Telegram diperlukan.</div>
              </div>
              <div class="col-md-6">
                <input class="form-control" id="alamat" name="alamat" type="text" placeholder="Alamat" required />
                <div class="invalid-feedback">Alamat diperlukan.</div>
              </div>
              <div class="col-md-6">
                <select class="form-select" id="pilihan_tinggal" name="pilihan_tinggal" required>
                  <option value="" disabled selected>Pilih Tempat Tinggal</option>
                  <option value="Orangtua">Tinggal dengan Orangtua</option>
                  <option value="Keluarga">Tinggal dengan Keluarga</option>
                  <option value="Kost">Kost</option>
                </select>
                <div class="invalid-feedback">Pilih tempat tinggal.</div>
              </div>
              <div class="col-md-6">
                <input class="form-control" id="kampus" name="kampus" type="text" placeholder="Asal Kampus" required />
                <div class="invalid-feedback">Asal Kampus diperlukan.</div>
              </div>
              <div class="col-md-6">
                <input class="form-control" id="jurusan" name="jurusan" type="text" placeholder="Jurusan" required />
                <div class="invalid-feedback">Jurusan diperlukan.</div>
              </div>
              <div class="col-12">
                <label class="form-label fw-semibold mb-2">Unggah Foto <span class="text-muted">(.jpg, .jpeg, .png, maks 2MB)</span></label>
                <input type="file" class="form-control" id="photo" name="photo" accept=".jpg,.jpeg,.png" required />
                <div class="invalid-feedback">Foto diperlukan (.jpg, .jpeg, .png, maks 2MB).</div>
              </div>
              <div class="col-12">
                <textarea class="form-control" id="alasan" name="alasan" placeholder="Alasan Bergabung" required></textarea>
                <div class="invalid-feedback">Alasan diperlukan.</div>
              </div>
              <div class="col-12 d-none" id="submitSuccessMessage">
                <div class="text-center text-success">
                  <div class="fw-bold">Pendaftaran Berhasil!</div>
                  <p>Kami akan menghubungi kontak yang Anda berikan.</p>
                  <a href="{{ url_for('index') }}" class="btn btn-outline-primary rounded-pill px-4">Kembali ke Beranda</a>
                </div>
              </div>
              <div class="col-12 d-none" id="submitErrorMessage">
                <div class="text-center text-danger">Terjadi kesalahan. Coba lagi!</div>
              </div>
              <div class="col-12 text-center mt-3">
                <button class="btn" id="submitButton" type="submit">DAFTAR SEKARANG</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById('daftarForm');
    const submitButton = document.getElementById('submitButton');
    const successMessage = document.getElementById('submitSuccessMessage');
    const errorMessage = document.getElementById('submitErrorMessage');

    function showToast(type, message) {
      const toast = document.createElement('div');
      toast.className = `toast bg-${type} text-white`;
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>`;
      document.getElementById('toast-container').appendChild(toast);
      const bsToast = new bootstrap.Toast(toast, { delay: 4000 });
      bsToast.show();
      setTimeout(() => toast.remove(), 5000);
    }

    function validateForm() {
      let isValid = true;
      const fields = ['nama_lengkap', 'nama_panggilan', 'email', 'nomor_wa', 'username_telegram', 'alamat', 'pilihan_tinggal', 'kampus', 'jurusan', 'alasan'];
      fields.forEach(id => {
        const field = document.getElementById(id);
        if (!field.value.trim()) {
          field.classList.add('is-invalid');
          isValid = false;
        } else {
          field.classList.remove('is-invalid');
        }
      });

      const gender = document.querySelector('input[name="jenis_kelamin"]:checked');
      const genderGroup = document.querySelector('.d-flex.gap-4');
      if (!gender) {
        genderGroup.nextElementSibling.classList.add('d-block');
        isValid = false;
      } else {
        genderGroup.nextElementSibling.classList.remove('d-block');
      }

      const email = document.getElementById('email');
      if (email.value && !/^\S+@\S+\.\S+$/.test(email.value)) {
        email.classList.add('is-invalid');
        isValid = false;
      }

      const wa = document.getElementById('nomor_wa');
      if (wa.value && !/^[0-9+\-\s]{6,20}$/.test(wa.value)) {
        wa.classList.add('is-invalid');
        isValid = false;
      }

      const photo = document.getElementById('photo');
      if (photo.files.length) {
        const file = photo.files[0];
        const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
        if (!validTypes.includes(file.type) || file.size > 2 * 1024 * 1024) {
          photo.classList.add('is-invalid');
          isValid = false;
        } else {
          photo.classList.remove('is-invalid');
        }
      } else {
        photo.classList.add('is-invalid');
        isValid = false;
      }

      submitButton.disabled = !isValid;
      return isValid;
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      submitButton.disabled = true;

      if (validateForm()) {
        const formData = new FormData(form);
        fetch('/api/postData', { method: 'POST', body: formData })
          .then(response => {
            if (!response.ok) throw new Error('Gagal mengirim formulir');
            return response.json();
          })
          .then(data => {
            if (data.status === 'success') {
              form.reset();
              successMessage.classList.remove('d-none');
              errorMessage.classList.add('d-none');
              showToast('success', 'Pendaftaran berhasil! Kami akan menghubungi kontak Anda.');
            } else {
              throw new Error('Kesalahan server');
            }
          })
          .catch(() => {
            errorMessage.classList.remove('d-none');
            successMessage.classList.add('d-none');
            showToast('danger', 'Terjadi kesalahan. Coba lagi.');
          })
          .finally(() => {
            submitButton.disabled = false;
          });
      } else {
        showToast('danger', 'Lengkapi formulir dengan benar.');
        submitButton.disabled = false;
      }
    });

    form.querySelectorAll('input, select, textarea').forEach(input => {
      input.addEventListener('input', validateForm);
      input.addEventListener('change', validateForm);
    });
  });
</script>
{% endblock %}